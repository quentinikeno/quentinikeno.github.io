<!DOCTYPE html>
<!--[if IE 8 ]><html class="ie ie8" lang="english"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<html lang="english">
<!--<![endif]-->
	<head>
            <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <meta name="author" content="Quentin">


        <title>Quentin Ikeno - Detective Conan Episode Database</title>


        <!-- CSS -->
        <link rel="stylesheet" href="/theme/css/style.css">

        <!-- Custom CSS -->
        	<link rel="stylesheet" href="/theme/css/colors/navy.css" id="colors">

        <!-- Code highlight color scheme -->
            <link href="/theme/css/code_blocks/darkly.css" rel="stylesheet">


        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->




        <meta name="tags" contents="Python" />
        <meta name="tags" contents="SQL" />
        <meta name="tags" contents="Web Scraping" />
        <meta name="tags" contents="Data Analysis" />
    <meta property="og:type" content="article">
    <meta property="og:title" content="Detective Conan Episode Database">
    <meta property="og:url" content="detective-conan-episode-database.html">
    <meta property="og:description" content="I&#39;ll be web scraping and analyzing data for a popular tv series using Python and SQLite.">
    <meta property="article:published_time" content="Wednesday, February 21, 2018">
    <meta name="twitter:title" content="Detective Conan Episode Database">
    <meta name="twitter:description" content="I&#39;ll be web scraping and analyzing data for a popular tv series using Python and SQLite.">
    <meta name="description" content="I&#39;ll be web scraping and analyzing data for a popular tv series using Python and SQLite.">
    <meta name="twitter:image" content="">
    <meta property="og:image" content="">

	                <meta property="og:locale" content="">
		<meta property="og:site_name" content="Quentin Ikeno">

	<meta property="og:type" content="article">
	<meta property="article:author" content="">
	<meta property="og:url" content="/detective-conan-episode-database.html">
	<meta property="og:title" content="Detective Conan Episode Database">
	<meta property="og:description" content="">
	   <meta property="og:image" content="/images/guilherme-toti.jpg">
	<meta property="article:published_time" content="2018-02-21 00:00:00-10:00">
	</head>
	<body>
		<header id="header">
			<!-- Container -->
			<div class="container">
				<!-- Logo / Mobile Menu -->
				<div class="five columns">
					<div id="textlogo">
						<h1><a href="/">Quentin Ikeno</a></h1>
					</div>
				</div>
						<!-- Navigation
				================================================== -->
				<div class="eleven columns">

					<nav id="navigation" class="menu">
						<ul id="responsive">

							<li><a href="/">Home</a></li>


							        <li><a href="/pages/about-me.html">About Me</a></li>
						</ul>
					</nav>
				</div>
			</div>
			<!-- Container / End -->
		</header>
		<!-- Header / End -->

		<!-- Breadcrumbs Container-->
		<div id="content-wrapper">
			<section id="titlebar">
				<!-- Container -->
				<div class="container">
				<div class="thirteen columns">
					<nav id="breadcrumbs">
						<ul>
							<li>You are here:</li>
							<li><a href="/">Home</a></li>
<li><a href="/category/side-projects.html">Side Projects</a></li>
<li>Detective Conan Episode Database</li>
						</ul>
					</nav>
				</div>
				</div>
				<!-- Container / End -->
			</section>

			<div class="container">
	<div class="twelve alt columns">
<article class="post" style="margin: 0; border: 0;">

	<section class="post-content">

		<header class="meta">
			<h2><a href="/detective-conan-episode-database.html">Detective Conan Episode Database</a></h2>
			<ul>
				<li>By <a href="/author/quentin-ikeno.html">Quentin Ikeno</a></li>
				<li>Wed 21 February 2018</li>
			</ul>
		</header>

		<h2><a id='top'></a></h2>
<h3>Table of Contents</h3>
<ol>
<li><a href="#intro">Introduction</a></li>
<li><a href="#scrape">Web Scraping</a></li>
<li><a href="#sqlite">Analysis Using SQLite</a></li>
<li><a href="#end">Conclusion</a></li>
</ol>
<p><a id='intro'></a></p>
<h2>Introduction</h2>
<p><a href="#top">Back to Top</a></p>
<p><img src=images/conan_header.png alt="conan header" width="546" height="213" /></p>
<p><em>Detective Conan</em> (also known as <em>Case Closed</em> in America) is a Japanese detective anime series.  It's a show introduced to me by my girlfriend, who used to watch it on Cartoon Network's Adult Swim block when she was a kid.  If you aren't familiar with this series, one thing to know is that it's been running non-stop since 1996–this show is almost as old as me!  This also means it has a substantial amount of data we can analyze.  The <a href="http://www.detectiveconanworld.com/wiki/Anime">Detective Conan World Wiki</a> (DCW Wiki) contains a list of every single episode, along with data such as when the episode aired and what kind of plot points were contained in the episode.  My goal for this will be to scrape the data from the wiki, and do some analysis using SQL.</p>
<p><a id='scrape'></a></p>
<h2>Web Scraping</h2>
<p><a href="#top">Back to Top</a></p>
<p>The first thing I had to do was to scrape the episode data from the webpage, starting from episode one to the most recent episode as of today (January 23, 2018).  I used the Beautiful Soup package to extract the data.  I've only ever done web scraping once or twice before, so I was a little nervous that I couldn't do it.  But at the end, seeing the dataset I scraped and knowing that I got all the data I wanted was definitely a confidence booster.  That said, if there was a way that I could have made this easier or more efficient please let me know.</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">urllib</span> <span class="kn">import</span> <span class="n">urlopen</span> <span class="k">as</span> <span class="n">ureq</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>

<span class="n">my_url</span> <span class="o">=</span> <span class="s1">&#39;http://www.detectiveconanworld.com/wiki/Anime&#39;</span>

<span class="c1">#openning connection grabbing page</span>
<span class="n">uclient</span> <span class="o">=</span> <span class="n">ureq</span><span class="p">(</span><span class="n">my_url</span><span class="p">)</span>
<span class="n">html_page</span> <span class="o">=</span> <span class="n">uclient</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">uclient</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1">#html parsing</span>
<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">html_page</span><span class="p">,</span> <span class="s1">&#39;html.parser&#39;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="c1">#grabs each season table</span>
<span class="n">season_table</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;table&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span><span class="s1">&#39;wikitable seasontable headerlink&#39;</span><span class="p">})</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1">#scrape data</span>
<span class="k">for</span> <span class="n">episode</span> <span class="ow">in</span> <span class="n">season_table</span><span class="p">:</span>
    <span class="n">trs</span> <span class="o">=</span> <span class="n">episode</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="n">trs</span><span class="p">:</span>
        <span class="n">ep_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">tds</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">td</span> <span class="ow">in</span> <span class="n">tds</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">ep_dict</span><span class="p">[</span><span class="s1">&#39;japanese_episode_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">td</span> <span class="ow">in</span> <span class="n">tds</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">ep_dict</span><span class="p">[</span><span class="s1">&#39;english_episode_number&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">td</span> <span class="ow">in</span> <span class="n">tds</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">3</span><span class="p">]:</span>
            <span class="n">ep_dict</span><span class="p">[</span><span class="s1">&#39;episode_title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">td</span> <span class="ow">in</span> <span class="n">tds</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">4</span><span class="p">]:</span>
            <span class="n">ep_dict</span><span class="p">[</span><span class="s1">&#39;original_airdate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">td</span> <span class="ow">in</span> <span class="n">tds</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">5</span><span class="p">]:</span>
            <span class="n">ep_dict</span><span class="p">[</span><span class="s1">&#39;english_airdate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">td</span> <span class="ow">in</span> <span class="n">tds</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">6</span><span class="p">]:</span>
            <span class="n">plot_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">all_story_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;New character&#39;</span><span class="p">,</span> <span class="s1">&#39;Character development&#39;</span><span class="p">,</span> <span class="s1">&#39;Magic Kaito&#39;</span><span class="p">,</span> <span class="s1">&#39;Romance&#39;</span><span class="p">,</span> <span class="s1">&#39;Characters pasts&#39;</span><span class="p">,</span>\
                                   <span class="s1">&#39;Black Organization&#39;</span><span class="p">,</span> <span class="s1">&#39;FBI&#39;</span><span class="p">]</span>
            <span class="n">plot_points</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;href&#39;</span><span class="p">:</span><span class="s1">&#39;/wiki/Detective_Conan_Wiki:Plot_Legend&#39;</span><span class="p">})</span>
            <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">plot_points</span><span class="p">:</span>
                <span class="n">story</span> <span class="o">=</span> <span class="n">point</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
                <span class="n">plot_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">story</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">story_type</span> <span class="ow">in</span> <span class="n">all_story_types</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">story_type</span> <span class="ow">in</span> <span class="n">plot_list</span><span class="p">:</span>
                    <span class="n">ep_dict</span><span class="p">[</span><span class="n">story_type</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;yes&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ep_dict</span><span class="p">[</span><span class="n">story_type</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;no&#39;</span>
        <span class="k">for</span> <span class="n">td</span> <span class="ow">in</span> <span class="n">tds</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">7</span><span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">manga_source</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">a</span><span class="o">.</span><span class="n">text</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">manga_source</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">text</span>
            <span class="n">ep_dict</span><span class="p">[</span><span class="s1">&#39;manga_source&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">manga_source</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">td</span> <span class="ow">in</span> <span class="n">tds</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">8</span><span class="p">]:</span>
            <span class="n">ep_dict</span><span class="p">[</span><span class="s1">&#39;next_conans_hint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">,</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ep_dict</span><span class="p">)</span>

<span class="c1">#Find indexes of empty dictionaries in list</span>
<span class="n">empty</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="p">{}]</span>
<span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1">#delete the empty dictionaries using the indexes</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">empty</span><span class="p">:</span>
    <span class="k">del</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">counter</span><span class="p">]</span>
    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="c1">#pprint(data)</span>
</pre></div>


<p>After getting the data, the next thing I did was to put the data into a list of dictionaries, with each dictionary in the list containing data for each individual episode.  I then exported the list to a csv file so I could use it to make a database.</p>
<div class="highlight"><pre><span></span><span class="c1">#write scraped data to a csv file</span>
<span class="n">keys</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;conan_tv.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">output_file</span><span class="p">:</span>
    <span class="n">output_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;romance,new_character,character_development,magic_kaito,english_airdate,next_conans_hint,original_airdate,episode_title,japanese_episode_number,characters_pasts,black_organization,manga_source,fbi,english_episode_number</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">dict_writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictWriter</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">keys</span><span class="p">)</span>
    <span class="n">dict_writer</span><span class="o">.</span><span class="n">writerows</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">output_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1">#print &#39;All Done!&#39;</span>
</pre></div>


<p><a id='sqlite'></a></p>
<h2>Analysis Using SQLite</h2>
<p><a href="#top">Back to Top</a></p>
<p>Now that I had the csv, just to make things easier on myself and save time, I used DB Browser for SQLite to create the database and table for the data; I decided to call the table <strong>tv</strong>.</p>
<p><img alt="table" src="images/conan_table.PNG"></p>
<p>An issue I ran into when creating the table was that I was orignally going to put episode numbers as INTEGER types.  However, the TV specials in the data don't have numbers for their episode; for instance the <em>Magic Kaito</em> specials have "MKS#" listed for their episode numbers.  Thus, I had to keep the episode numbers as text.</p>
<p>After I was done creating the database, I decided that I wanted to perform all of my queries within this notebook.  To that end, I chose to use the sqlite3 package to be able to use SQL in Python.</p>
<h3>Total Episodes in Database</h3>
<p><a id='total_eps'></a></p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>

<span class="c1">#connect to the database</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;conan.db&#39;</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="c1">#write an sql query</span>
<span class="n">QUERY</span> <span class="o">=</span> <span class="s1">&#39;SELECT COUNT(id) </span><span class="se">\</span>
<span class="s1">         FROM tv;&#39;</span>

<span class="k">def</span> <span class="nf">sql_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Takes a sql query and a message and displays the message along side the result of the query.&#39;&#39;&#39;</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">message</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

<span class="k">print</span> <span class="n">sql_query</span><span class="p">(</span><span class="n">QUERY</span><span class="p">,</span> <span class="s1">&#39;total episodes in database: {}&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="mi">993</span> <span class="o">*</span> <span class="mi">24</span>
<span class="k">print</span> <span class="mi">993</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">/</span> <span class="mf">60.</span>
<span class="k">print</span> <span class="mi">993</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">/</span> <span class="mf">24.</span>
</pre></div>


<div class="highlight"><pre><span></span>total episodes in database: 993
23832
397.2
16.5416666667
</pre></div>


<p>There a total of 993 episodes in this database; that includes all of the regular episodes, TV specials, reruns, and remastered episodes.  If we assume each episode has a runtime of 24 minutes, excluding commercials, 993 episodes is equivalent to:</p>
<ul>
<li>23832 minutes,</li>
<li>roughly 397 hours, or</li>
<li>about 16.5 days.</li>
</ul>
<p>That said, <em>Detective Conan</em> sometimes has specials that are an hour to two and a half hours long, so the actual runtime of all 993 episodes should be slightly higher.  Regardless, the point is:  this is not a series to binge watch in one sitting.</p>
<h3>Number of Regular Episodes</h3>
<div class="highlight"><pre><span></span><span class="n">QUERY</span> <span class="o">=</span> <span class="s1">&#39;SELECT japanese_episode_number </span><span class="se">\</span>
<span class="s1">         FROM tv </span><span class="se">\</span>
<span class="s1">         WHERE id = 993&#39;</span>

<span class="k">print</span> <span class="n">sql_query</span><span class="p">(</span><span class="n">QUERY</span><span class="p">,</span> <span class="s1">&#39;total number of regular episodes: {}&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="mi">993</span> <span class="o">-</span> <span class="mi">890</span>
</pre></div>


<div class="highlight"><pre><span></span>total number of regular episodes: 890
103
</pre></div>


<p>There are 890 of what I am going to call regular episodes, or all the episodes that are not reruns, remasters, or TV specials.  If we subtract the total number of regular episodes from the amount of episodes total, we get 103, which is the number of episodes that are TV specials, reruns, and remasters.</p>
<h3>Plot Elements</h3>
<p>The DCW Wiki anime chart contains a collumn called "Plot" which indicates whether anything significant happened during an episode that is relevant to the overall plot of the series.  The "Plot" collumn utilizes different symbols to specify what sort of plot development occured.  Below is the wiki's description of what each symbol means:</p>
<p><img alt="legend" src="images/conan_plot_legend.PNG"></p>
<p>Using this plot data, I wanted to see how many episodes contained any sort of plot development; i.e. episodes containing at least one of the above symbols.</p>
<div class="highlight"><pre><span></span><span class="n">QUERY</span> <span class="o">=</span> <span class="s2">&quot;SELECT COUNT(id) </span><span class="se">\</span>
<span class="s2">         FROM tv </span><span class="se">\</span>
<span class="s2">         WHERE (romance == &#39;yes&#39; OR </span><span class="se">\</span>
<span class="s2">         new_character == &#39;yes&#39; OR </span><span class="se">\</span>
<span class="s2">         character_development == &#39;yes&#39; OR </span><span class="se">\</span>
<span class="s2">         characters_pasts == &#39;yes&#39; OR </span><span class="se">\</span>
<span class="s2">         black_organization == &#39;yes&#39; OR </span><span class="se">\</span>
<span class="s2">         magic_kaito == &#39;yes&#39; OR fbi == &#39;yes&#39;);&quot;</span>

<span class="k">print</span> <span class="n">sql_query</span><span class="p">(</span><span class="n">QUERY</span><span class="p">,</span> <span class="s1">&#39;episodes with plot: {}&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="mi">443</span> <span class="o">/</span> <span class="mf">993.</span>
</pre></div>


<div class="highlight"><pre><span></span>episodes with plot: 443
0.44612286002
</pre></div>


<p>443 episodes or about 45% of all episodes contain some sort of plot element.  In regards to this, <em>Detective Conan</em> is less of a plot-driven show and more of a "case of the week" show, with emphasis placed on presenting a new and intriguing mystery and seeing how Conan can use his skills in deduction to solve it.  Thus, plot developments in <em>Detective Conan</em> are typically very small and the story moves at the pace of a sloth in the body of a snail.  But I assume this is a nonissue for most fans who just enjoy being along for the ride.</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>

<span class="c1">#put the csv data into a pandas df</span>
<span class="n">conan</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;conan_tv.csv&#39;</span><span class="p">)</span>
<span class="c1">#for each story type put the number of yes into a list &quot;y&quot; to use to make the bar chart</span>
<span class="n">story_types</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;new_character&#39;</span><span class="p">,</span> <span class="s1">&#39;character_development&#39;</span><span class="p">,</span> <span class="s1">&#39;magic_kaito&#39;</span><span class="p">,</span> <span class="s1">&#39;romance&#39;</span><span class="p">,</span> <span class="s1">&#39;characters_pasts&#39;</span><span class="p">,</span>\
                                   <span class="s1">&#39;black_organization&#39;</span><span class="p">,</span> <span class="s1">&#39;fbi&#39;</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">story_type</span> <span class="ow">in</span> <span class="n">story_types</span><span class="p">:</span>
    <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">conan</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">story_type</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">y</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1">#plot the number of plot elements</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="s1">&#39;paper&#39;</span><span class="p">,</span> <span class="n">font_scale</span><span class="o">=</span><span class="mf">1.35</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">story_types</span><span class="p">))</span>
<span class="n">bar_width</span> <span class="o">=</span> <span class="mf">0.75</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">bar_width</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;cornflowerblue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Plot Elements&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Number of Episodes&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">story_types</span><span class="p">)),</span> <span class="p">[</span><span class="s1">&#39;Character Development&#39;</span><span class="p">,</span> <span class="s1">&#39;Romance&#39;</span><span class="p">,</span> <span class="s1">&#39;New Character&#39;</span><span class="p">,</span> <span class="s1">&#39;Black Organization&#39;</span><span class="p">,</span> \
                                         <span class="s1">&#39;Characters Pasts&#39;</span><span class="p">,</span> <span class="s1">&#39;Magic Kaito&#39;</span><span class="p">,</span> <span class="s1">&#39;FBI&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="images/conan_27_0.png"></p>
<p>I wanted to compare the amount of each plot elements throughout the series, so to make the comparision easier I created a bar chart instead of doing normal SQL queries.  Character development has the most amount of episodes, followed by romance.  I was a little surprised that the FBI are featured in about the same amount of episodes as Kaitou Kid considering, that the FBI were introduced into the series way later than Kaito Kid.</p>
<h3>Source Material</h3>
<div class="highlight"><pre><span></span><span class="n">QUERY</span> <span class="o">=</span> <span class="s2">&quot;SELECT COUNT(id) </span><span class="se">\</span>
<span class="s2">         FROM tv </span><span class="se">\</span>
<span class="s2">         WHERE manga_source == &#39;TV Original&#39;;&quot;</span>

<span class="k">print</span> <span class="n">sql_query</span><span class="p">(</span><span class="n">QUERY</span><span class="p">,</span> <span class="s1">&#39;tv originals: {}&#39;</span><span class="p">)</span>
<span class="k">print</span> <span class="mi">993</span> <span class="o">-</span> <span class="mi">368</span>
</pre></div>


<div class="highlight"><pre><span></span>tv originals: 368
625
</pre></div>


<p>625 of all the episodes are based on the <em>Detective Conan</em> or <em>Magic Kaito</em> mangas, while 368 are not based on any source material.</p>
<h3>Next Conan's Hint</h3>
<div class="highlight"><pre><span></span><span class="n">QUERY</span> <span class="o">=</span> <span class="s2">&quot;SELECT next_conans_hint, COUNT(next_conans_hint) AS number </span><span class="se">\</span>
<span class="s2">         FROM tv </span><span class="se">\</span>
<span class="s2">         WHERE NOT next_conans_hint == &#39;N/A&#39; </span><span class="se">\</span>
<span class="s2">         GROUP BY next_conans_hint </span><span class="se">\</span>
<span class="s2">         ORDER BY number desc </span><span class="se">\</span>
<span class="s2">         LIMIT 10;&quot;</span> 

<span class="c1">#put sql query into a pandas df</span>
<span class="n">top_hints</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="n">QUERY</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>
<span class="c1">#name the collumns</span>
<span class="n">top_hints</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Hint&#39;</span><span class="p">,</span> <span class="s1">&#39;Frequency&#39;</span><span class="p">]</span>
<span class="c1">#create the index for the df</span>
<span class="n">top_hints</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">top_hints</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1">#close connection</span>
<span class="n">c</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">print</span> <span class="s1">&#39;&#39;</span>
<span class="k">print</span> <span class="s1">&#39;Top 10 &quot;Next Conan</span><span class="se">\&#39;</span><span class="s1">s Hint&quot;&#39;</span>
<span class="k">print</span> <span class="n">top_hints</span>
</pre></div>


<div class="highlight"><pre><span></span>Top 10 &quot;Next Conan&#39;s Hint&quot;
             Hint  Frequency
1           Clock          5
2             Ice          5
3   Cassette tape          4
4             Cat          4
5      Cell phone          4
6          Mirror          4
7       Nameplate          4
8           Paint          4
9        Umbrella          4
10           Wind          4
</pre></div>


<p>The "Next Conan's Hint" is a hint given at the end of every episode; it gives viewers a heads-up about something they should look out for in the next episode that will be important for Conan's deduction.  Given the length of the series, I was certain that some of the hints had to have been repeated at least a few times.  I was interested to see that cat, was the only living thing appearing in this list and was featured four times.  I also thought that cassette tape and cell phone being featured the same amount of times is an indicator of the show's age.</p>
<p><a id=end></a></p>
<h2>Conclusion</h2>
<p><a href="#top">Back to Top</a></p>
<p>Here is where I'll conclude the analysis.  One idea I came up with when doing this project was to somehow use machine learning to try and predict the culprit in an episode of <em>Detective Conan</em>.  I'll have to work out the details and see if it is even possible to do such a thing, so I'll save that project for another day.</p>
<h2>References</h2>
<p>http://www.detectiveconanworld.com/wiki/Anime</p>
<p>https://res.cloudinary.com/sfp/image/upload/c_fill,q_60/oth/FunimationStoreFront/1353682/English/1353682_English_ShowDetailHeaderDesktop_463281e7-5250-e711-8175-020165574d09.jpg</p>
		    <div class="tags">
		        <p>tags: <a href="/tag/python.html">Python</a><a href="/tag/sql.html">SQL</a><a href="/tag/web-scraping.html">Web Scraping</a><a href="/tag/data-analysis.html">Data Analysis</a></p>
		    </div>

<div class="sharing">
</div>
<hr>

	</section>
	<div class="clearfix"></div>

</article>

	</div>

	<!-- Sidebar -->
	<div class="four columns">

		<!-- Categories -->
		<div class="widget no-mg-top">
			<h3 class="headline">Categories</h3><span class="line"></span><div class="clearfix"></div>
			<nav class="categories">
				<ul>
					    <li><a href="/category/data-analyst-nanodegree.html">Data Analyst Nanodegree</a></li>
					    <li class="active"><a href="/category/side-projects.html">Side Projects</a></li>
				</ul>
			</nav>
		</div>
		
	</div>
			</div>
			<!-- Container / End -->
		</div>
		<!-- Content Wrapper / End -->

		<div id="footer-bottom">
			<!-- Container -->
			<div class="container">
				<div class="eight columns">&copy;  || Blog powered by <a href="http://getpelican.com">Pelican</a></div>
					<div class="eight columns">
						<ul class="social-icons-footer">
								<li>
									<a href="https://www.linkedin.com/in/quentin-ikeno/" class="tooltip top" title="linkedin">
										<i class="icon-linkedin"></i>
									</a>
								</li>
								<li>
									<a href="https://github.com/quentinikeno" class="tooltip top" title="github">
										<i class="icon-github"></i>
									</a>
								</li>
							<li><a href="/None" class="tooltip top" title="RSS"><i class="icon-rss"></i></a></li>
						</ul>
					</div>
			</div>
			<!-- Container / End -->
		</div>
		<!-- Footer Bottom / End -->

	<!-- Javascripts -->
	<script src="/theme/js/jquery.min.js"></script>
	</body>
</html>